# 坦克动荡 - 测试套件

## 概述

这个测试包包含了坦克动荡游戏的完整测试套件，涵盖游戏逻辑、多人游戏和网络功能的各个方面。

## 测试结构

```
test/
├── __init__.py                  # 测试包初始化
├── run_all_tests.py             # 综合测试运行器
├── test_game_logic.py           # 游戏逻辑测试
├── test_multiplayer.py          # 多人游戏测试
├── test_network.py              # 网络功能测试
├── test_integration.py          # 系统集成测试
├── test_arcade_api.py           # Arcade API兼容性测试
├── test_minimal_multiplayer.py  # 最小多人游戏测试
├── multiplayer_demo.py          # 多人游戏演示
├── color.py                     # 颜色测试工具
└── README.md                   # 本文档
```

## 快速开始

### 运行所有测试
```bash
cd tank/test
python run_all_tests.py
```

### 运行特定测试套件
```bash
# 只运行游戏逻辑测试
python run_all_tests.py --game-logic-only

# 只运行多人游戏测试
python run_all_tests.py --multiplayer-only

# 只运行网络功能测试
python run_all_tests.py --network-only

# 快速测试（跳过耗时的网络测试）
python run_all_tests.py --quick
```

### 运行单个测试文件
```bash
# 游戏逻辑测试
python test_game_logic.py

# 多人游戏测试
python test_multiplayer.py

# 网络功能测试
python test_network.py
```

### 运行演示程序
```bash
# 多人游戏演示
python multiplayer_demo.py
```

### 运行专项测试
```bash
# 系统集成测试
python test_integration.py

# Arcade API兼容性测试
python test_arcade_api.py

# 最小多人游戏测试
python test_minimal_multiplayer.py
```

## 测试套件详情

### 1. 游戏逻辑测试 (test_game_logic.py)

测试游戏核心逻辑和组件：

- **坦克创建测试**: 验证坦克对象的正确创建
- **坦克移动测试**: 测试坦克移动和物理同步
- **子弹发射测试**: 验证射击系统和冷却机制
- **伤害系统测试**: 测试血量、伤害和死亡逻辑
- **地图生成测试**: 验证地图生成和格式
- **物理引擎测试**: 测试Pymunk物理引擎集成

### 2. 多人游戏测试 (test_multiplayer.py)

测试多人游戏核心功能：

- **消息序列化测试**: 验证网络消息的序列化和反序列化
- **房间发现测试**: 测试UDP广播房间发现机制
- **主机-客户端连接测试**: 验证连接建立和通信

### 3. 网络功能测试 (test_network.py)

测试网络相关的高级功能：

- **端口可用性测试**: 检查游戏端口是否可用
- **网络延迟测试**: 测量本地网络延迟
- **连接稳定性测试**: 验证长时间连接的稳定性
- **多客户端连接测试**: 测试多个客户端同时连接
- **断线重连测试**: 验证断线检测和重连机制

### 4. 系统集成测试 (test_integration.py)

测试多人游戏模块与主游戏的集成：

- **模块导入测试**: 验证所有模块正确导入
- **游戏集成测试**: 测试坦克类扩展和功能集成
- **网络功能测试**: 验证网络组件创建和消息处理

### 5. Arcade API兼容性测试 (test_arcade_api.py)

测试Arcade库API兼容性：

- **绘制函数检查**: 验证所需的绘制函数可用性
- **版本兼容性**: 检查Arcade版本和API变化
- **功能完整性**: 确保所有必需功能正常工作

### 6. 最小多人游戏测试 (test_minimal_multiplayer.py)

快速验证多人游戏核心功能：

- **网络模块测试**: 基础网络组件创建
- **视图创建测试**: 多人游戏界面组件
- **集成验证测试**: 主菜单集成检查
- **兼容性测试**: Arcade API兼容性快速检查

## 测试环境要求

### 系统要求
- Python 3.11+
- 已安装项目依赖 (arcade, pymunk)

### 网络要求
- UDP端口 12345-12346 可用
- 防火墙允许UDP通信
- 局域网环境（用于网络测试）

### 权限要求
- 网络套接字创建权限
- 文件系统访问权限

## 测试结果解读

### 成功标识
- ✅ 测试通过
- 🎉 所有测试通过
- ⚡ 快速测试模式
- 🌐 网络测试模式

### 警告标识
- ⚠️ 部分测试失败
- 📊 测试统计信息

### 错误标识
- ❌ 测试失败
- 💥 严重错误
- ⏹️ 用户中断

### 测试报告格式
```
🏁 最终测试摘要
==========================================
✅ 游戏逻辑     :  6/ 6 (100.0%)
✅ 多人游戏     :  3/ 3 (100.0%)
⚠️ 网络功能     :  4/ 5 ( 80.0%)
------------------------------------------
📊 总计          : 13/14 ( 92.9%)
⏱️ 执行时间      : 15.23 秒
🕐 结束时间      : 2024-01-15 14:30:45
```

## 故障排除

### 常见问题

**Q: 网络测试失败**
```
❌ 端口可用性测试失败
```
A: 检查防火墙设置，确保UDP端口12345-12346开放

**Q: 连接测试超时**
```
❌ 主机-客户端连接测试失败: 连接超时
```
A: 检查网络配置，确保本地回环接口正常

**Q: 物理引擎测试失败**
```
❌ 物理引擎测试失败: 模块导入错误
```
A: 确保pymunk库正确安装：`pip install pymunk`

**Q: 游戏逻辑测试失败**
```
❌ 坦克创建测试失败: 图片文件未找到
```
A: 确保在正确的目录运行测试，图片资源路径正确

### 调试模式

在测试文件中设置调试标志：
```python
DEBUG = True  # 启用详细日志输出
```

### 日志查看

测试过程中的详细信息会输出到控制台，包括：
- 测试步骤进度
- 网络连接状态
- 错误详细信息
- 性能统计数据

## 持续集成

### 自动化测试脚本
```bash
#!/bin/bash
# ci_test.sh - 持续集成测试脚本

echo "开始自动化测试..."

# 运行快速测试
python test/run_all_tests.py --quick

# 检查退出码
if [ $? -eq 0 ]; then
    echo "✅ 所有测试通过"
    exit 0
else
    echo "❌ 测试失败"
    exit 1
fi
```

### 测试覆盖率

当前测试覆盖的主要模块：
- ✅ tank_sprites.py (坦克和子弹类)
- ✅ maps.py (地图生成)
- ✅ multiplayer/ (多人游戏模块)
- ⚠️ game_views.py (部分覆盖)
- ⚠️ tank_selection.py (部分覆盖)

## 贡献指南

### 添加新测试

1. 在相应的测试文件中添加测试方法
2. 遵循现有的测试命名规范
3. 添加详细的测试说明和断言
4. 更新测试文档

### 测试最佳实践

- 每个测试应该独立运行
- 使用清晰的断言消息
- 及时清理测试资源
- 避免依赖外部服务
- 测试边界条件和错误情况

## 版本历史

- **v1.0**: 基础测试套件
  - 游戏逻辑测试
  - 多人游戏测试
  - 网络功能测试
  - 综合测试运行器

## 许可证

与主项目保持一致。
